FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IDNzY2FsZS1hcGIKZGVzY3JpcHRpb246ID4KICBVbmxvY2sgdGhl\
IHBvd2VyIG9mIHlvdXIgQVBJcy4gVGhpcyB3aWxsIGRlcGxveSBBcGljYXN0IHRvIHlvdXIgT3Bl\
bnNoaWZ0IGNsdXN0ZXIgYW5kIGNvbm5lY3QgCiAgaXQgdG8gYSBkZWRpY2F0ZWQgUmVkaXMuIEZv\
ciB0aGlzIHRvIGZ1bmN0aW9uIGNvcnJlY3RseSBpdCBuZWVkcyB0byBiZSBjb25maWd1cmVkIHdp\
dGggYSB0b2tlbgogIGFuZCBkb21haW4gZm9yIHRoZSBhY2NvdW50IGl0IHNob3VsZCBwdWxsIGl0\
J3MgY29uZmlndXJhdGlvbiB2YWx1ZXMgZnJvbSAodXN1YWxseSBpbiAzc2NhbGUubmV0KS4KCiAg\
WW91IGNhbiBjcmVhdGUgYW4gYWNjb3VudCB3aXRoIDNzY2FsZS5uZXQgaGVyZTogaHR0cHM6Ly93\
d3cuM3NjYWxlLm5ldC9zaWdudXAvCmJpbmRhYmxlOiBUcnVlCmFzeW5jOiBvcHRpb25hbAp0YWdz\
OgogIC0gbW9iaWxlLXNlcnZpY2UKbWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IDNTY2FsZQogIGNv\
bnNvbGUub3BlbnNoaWZ0LmlvL2ljb25DbGFzczogZmEgZmEtc3VwZXJwb3dlcnMKICBzZXJ2aWNl\
TmFtZTogM3NjYWxlCnBsYW5zOgogIC0gbmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246IERl\
cGxveSAzU2NhbGUKICAgIGZyZWU6IFRydWUKICAgIG1ldGFkYXRhOiB7fQogICAgcGFyYW1ldGVy\
czoKICAgIC0gbmFtZTogVEhSRUVTQ0FMRV9ET01BSU4KICAgICAgcmVxdWlyZWQ6IFRydWUKICAg\
ICAgZGVmYXVsdDogCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRsZTogM1NjYWxlIGRvbWFp\
biBuYW1lLCBpLmUuICJleGFtcGxlLWFkbWluLjNzY2FsZS5uZXQiCiAgICAtIG5hbWU6IFRIUkVF\
U0NBTEVfQUNDRVNTX1RPS0VOCiAgICAgIHJlcXVpcmVkOiBUcnVlCiAgICAgIGRlZmF1bHQ6IAog\
ICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IDNTY2FsZSBhY2Nlc3MgdG9rZW4gKGh0dHBz\
Oi8vc3VwcG9ydC4zc2NhbGUubmV0L2RvY3MvYWNjb3VudHMvdG9rZW5zI2NyZWF0aW5nLWFjY2Vz\
cy10b2tlbnMpCiAgICAtIG5hbWU6IFRIUkVFU0NBTEVfU0VSVklDRV9JRAogICAgICByZXF1aXJl\
ZDogVHJ1ZQogICAgICBkZWZhdWx0OiAKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIHRpdGxlOiAz\
U2NhbGUgc2VydmljZSBpZAogICAgLSBuYW1lOiBUSFJFRVNDQUxFX0VOQUJMRV9DT1JTCiAgICAg\
IHJlcXVpcmVkOiBUcnVlCiAgICAgIGRlZmF1bHQ6IFRydWUKICAgICAgdHlwZTogYm9vbAogICAg\
ICB0aXRsZTogRW5hYmxlIENPUlMgM1NjYWxlIHBsdWdpbj8KCg=="

RUN yum install -y jq

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
