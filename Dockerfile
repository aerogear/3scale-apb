FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.version"="0.1.0"
LABEL "com.redhat.apb.spec"=\
"bmFtZTogM3NjYWxlLWFwYgppbWFnZTogZmVlZGhlbnJ5LzNzY2FsZS1hcGIKZGVzY3JpcHRpb246\
ID4KICBVbmxvY2sgdGhlIHBvd2VyIG9mIHlvdXIgQVBJcy4gVGhpcyB3aWxsIGRlcGxveSBBcGlj\
YXN0IHRvIHlvdXIgT3BlbnNoaWZ0IGNsdXN0ZXIgYW5kIGNvbm5lY3QgCiAgaXQgdG8gYSBkZWRp\
Y2F0ZWQgUmVkaXMuIEZvciB0aGlzIHRvIGZ1bmN0aW9uIGNvcnJlY3RseSBpdCBuZWVkcyB0byBi\
ZSBjb25maWd1cmVkIHdpdGggYSB0b2tlbgogIGFuZCBkb21haW4gZm9yIHRoZSBhY2NvdW50IGl0\
IHNob3VsZCBwdWxsIGl0J3MgY29uZmlndXJhdGlvbiB2YWx1ZXMgZnJvbSAodXN1YWxseSBpbiAz\
c2NhbGUubmV0KS4KCiAgWW91IGNhbiBjcmVhdGUgYW4gYWNjb3VudCB3aXRoIDNzY2FsZS5uZXQg\
aGVyZTogaHR0cHM6Ly93d3cuM3NjYWxlLm5ldC9zaWdudXAvCmJpbmRhYmxlOiBUcnVlCmFzeW5j\
OiBvcHRpb25hbAp0YWdzOgogIC0gbW9iaWxlLXNlcnZpY2UKbWV0YWRhdGE6CiAgZGlzcGxheU5h\
bWU6IDNTY2FsZQogIGNvbnNvbGUub3BlbnNoaWZ0LmlvL2ljb25DbGFzczogZmEgZmEtc3VwZXJw\
b3dlcnMKICBzZXJ2aWNlTmFtZTogM3NjYWxlCnBsYW5zOgogIC0gbmFtZTogZGVmYXVsdAogICAg\
ZGVzY3JpcHRpb246IERlcGxveSAzU2NhbGUKICAgIGZyZWU6IFRydWUKICAgIG1ldGFkYXRhOiB7\
fQogICAgcGFyYW1ldGVyczoKICAgIC0gbmFtZTogVEhSRUVTQ0FMRV9ET01BSU4KICAgICAgcmVx\
dWlyZWQ6IFRydWUKICAgICAgZGVmYXVsdDogCiAgICAgIHR5cGU6IHN0cmluZwogICAgICB0aXRs\
ZTogM1NjYWxlIGRvbWFpbiBuYW1lLCBpLmUuICJleGFtcGxlLWFkbWluLjNzY2FsZS5uZXQiCiAg\
ICAtIG5hbWU6IFRIUkVFU0NBTEVfQUNDRVNTX1RPS0VOCiAgICAgIHJlcXVpcmVkOiBUcnVlCiAg\
ICAgIGRlZmF1bHQ6IAogICAgICB0eXBlOiBzdHJpbmcKICAgICAgdGl0bGU6IDNTY2FsZSBhY2Nl\
c3MgdG9rZW4gKGh0dHBzOi8vc3VwcG9ydC4zc2NhbGUubmV0L2RvY3MvYWNjb3VudHMvdG9rZW5z\
I2NyZWF0aW5nLWFjY2Vzcy10b2tlbnMpCiAgICAtIG5hbWU6IFRIUkVFU0NBTEVfU0VSVklDRV9J\
RAogICAgICByZXF1aXJlZDogVHJ1ZQogICAgICBkZWZhdWx0OiAKICAgICAgdHlwZTogc3RyaW5n\
CiAgICAgIHRpdGxlOiAzU2NhbGUgc2VydmljZSBpZAogICAgLSBuYW1lOiBUSFJFRVNDQUxFX0VO\
QUJMRV9DT1JTCiAgICAgIHJlcXVpcmVkOiBUcnVlCiAgICAgIGRlZmF1bHQ6IFRydWUKICAgICAg\
dHlwZTogYm9vbAogICAgICB0aXRsZTogRW5hYmxlIENPUlMgM1NjYWxlIHBsdWdpbj8KCg=="

RUN yum install -y jq

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
